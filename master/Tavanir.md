- [مقدمه](#menu)
- [پیش از شروع](#menu)
- [سرویس ثبت شناسه قبض](#menu)
- [سرویس بروزرسانی اطلاعات شناسه قبض](#menu)
- [سرویس حذف شناسه قبض از سامانه](#menu)
- [سرویس دریافت شناسه قبض](#menu)
- [سرویس حذف حساب](#menu)
- [سرویس دریافت اطلاعات پایه انشعاب](#menu)
- [سرویس استعلام بدهی انشعاب](#menu)
- [سرویس جستجو بر اساس شماره بدنه](#menu)
- [سرویس دریافت گروهی اطلاعات انشعاب](#menu)
- [دریافت اطلاعات فروش](#menu)
- [سرویس دریافت اطلاعات وصول](#menu)
- [سرویس دریافت تصویر آخرین قبض](#menu)
- [سرویس استعلام قبض های صادر شده در یک بازه زمانی](#menu)
- [سرویس ثبت اطلاعات پرداخت](#menu)
-  
## مقدمه
<p>
با توجه به ضرورت جلوگیری از هزینه ­های زاید چاپ و توزیع قبوض کاغذی و در راستای اجرای دولت الکترونیک و به منظور بهبود خدمات ارائه شده به مشترکین صنعت برق و کاهش زمان دوره وصول بهای برق مصرفی، سامانه قبوض الکترونیکی توسط شرکت توانیر طراحی و اجرا گردیده است. این سامانه در کنار خدماتی که ارائه میدهد امکاناتی جهت به اشتراک گذاشتن اطلاعات مشترکین و قبوض صادره مربوط به آنها را توسط وب سرویس در اختیار ذینفعان قرار میدهد که در این مستند به تشریح و نحوه بکارگیری این وب سرویس­ها پرداخته شده است.
</p>

<div class="box-end">
</div>

## پیش از شروع
* URL فراخوانی سرویس ها: https://api.pod.ir/srv/sc/nzh/doServiceCall
* تمامی درخواست ها با متد POST ارسال می­شوند.
* Header درخواست:
پارامترهای زیر در Header تمام درخواست ها ثابت است:


|           پارامتر    |    توضیحات                                 |
|----------------------|---------------------------------------------|
|    \_token\_    |    API token دریافتی از پنل کسب و کاری    |
|    \_token_issuer\_    |    این پارامتر دارای مقدار ثابت "1" است.    |
|    Content-Type    |    application/x-www-form-urlencoded    |

* بدنه درخواست:
پارامترهای زیر در بدنه تمام درخواست ها ثابت است:

|    پارامتر    |    توضیحات    |
|-------------------|----------------------------------------------------------------|
|    scProductId    |    شناسه سرویس در حال استفاده    |
|    scApiKey    |    API Key دریافتی برای سرویس مورد   نظر از پنل کسب و کاری     |

* json Object ها در پارامتری به نام body  ارسال می­شوند.
* ساختار پاسخ دریافتی پس از فراخوانی سرویس به صورت زیر است که پاسخ دریافتی از endpoint  مورد نظر در پارامتر result قرار دارد.

```javascript
{
	"hasError": false/true,
	"messageId": 0,
	"referenceNumber": "",
	"errorCode": 0,
	"count": 0,
	"ott": "",
	"result": {
		"result": "response",
		"header": {},
		"statusCode":
	}
}
```
<div class="box-end">
</div>
  

## سرویس ثبت شناسه قبض
برای این‌که یک ذینفع بتواند به اطلاعات مشترکین برق در سامانه دسترسی داشته باشد ابتدا لازم است که شناسه قبض مشترک را در سامانه به همراه کدملی کاربری که نیاز به اطلاعات آن مشترک دارد را در سامانه ثبت نماید.این‌کار با فراخوانی این وب‌سرویس انجام می‌گردد.

- شناسه سرویس : 40255
- پارمترهای ورودی : json با ساختار و پارامترهای زیرپ

|نام|عنوان|شرح| 
|-------|-----------|------|
| *MobileNo |شماره موبایل | شماره موبایل معتبر -اعتبارسنجی می‌گردد- اجباری |
| NatioanlCode | کدملی | کدملی معتبر -اعتبارسنجی می‌گردد |
| Email |   آدرس پست الکترونیکی |اجباری نمی‌باشد-اعتبارسنجی می‌گردد |
| billids | لیست شناسه قبض‌ها | یک آرایه بر اساس توضیحات |

لیست شناسه قبض‌های مربوط به پارامتر billids یک آرایه با ساختار زیر خواهد بود

| شرح | نوع | نام |
|------|-------|----|
| *BILL_IDENTIFIER | عددصحیح حداکثر 13 رقم | شناسه قبض |
| BillTitle | رشته حداکثر 40 کاراکتر | عنوان شناسه قبض |
| viaSms | Boolean (true,false) | قبض پیامک گردد |
| viaPrint | Boolean (true,false) |قبض چاپ گردد |
| viaEmail | Boolean (true,false) | قبض با پست الکترونیکی ارسال گردد |
| viaApp | Boolean (true,false) | قبض از طریق اپلیکیشن دریافت گردد |


#### توضیحات برخی پارامترها :

##### شناسه قبض
شناسه قبض یک عدد صحیح 13 رقمی می ‌باشد که به ازای هر مشترک در کل کشور برای همه شرکت‌های خدماتی منحصر به فرد می ‌باشد.مشترک برای استفاده از خدمات سامانه شناسه قبض مندرج در قبض برق خود را در سامانه ثبت نماید.سامانه ، شناسه قبض را اعتبارسنجی می‌نماید و در صورتی که بر اساس الگوریتم‌های اعتبارسنجی، شناسه قبض صحیح نباشد سیستم پیغام خطای متناسب را بر می‌گرداند.

در جدول زیر ساختار شناسه قبض توضیح داه شده است

  
|رقم 1 تا 8 | رقم 9 تا 11 | رقم 12 | رقم 13 | تعداد ارقام |
|-----|------|------|------|------|
|شماره منحصر به فرد مشترک | کد شرکت 3 رقم می باشد.اول اگر 0 یا 1 باشد یعنی فروش انرژی/ اگر 2 یا 3 باشد یعنی فروش انشعاب و اگر برابر 4 یا 5 باشد یعنی بابت خدمات پس از فروش می باشد.لیست شرکتها در پیوست آمده است| کد شرکت خدماتی برای برق به طور ثابت 2 می باشد | رقم کنترل بر اساس فرمول مبنای 11 | توضیحات

  
  



##### عنوان شناسه قبض
کاربر می‌تواند برای شناسه تعریف شده یک عنوان تعریف کند بطور مثال یک شناسه قبض مربوط به خانه خود را به 
عنوان "قبض منزل" تعریف کند.

##### شماره موبایل
هر کاربر بایستی شماره تلفن همراه خود را به همراه شناسه قبض در سامانه ثبت نماید

##### کدملی
هر کاربر باید کدملی خود را به عنوان صاحب شناسه قبض ثبت شده در سیستم در سامانه ثبت نماید.این کدملی 10 رقمی در سامانه اعتبارسنجی خواهد شد و ذینفعان سامانه باید در هنگام استفاده از این سامانه آن را مدنظر قراردهند.

با فراخوانی این وب سرویس یک ذینفع سامانه می‌تواند یک شناسه قبضی را که کاربر وی خواهان در اختیار داشتن اطلاعات آن می‌باشد را در سامانه ثبت کند.باید توجه نمود شناسه قبضی که در سامانه ثبت نشده باشد توابع مربوط به اطلاعات مشترکین بدان پاسخ نخواهند داد.



## سرویس بروزرسانی اطلاعات شناسه قبض

 با استفاده از این سرویس میتوان اطلاعاتی را که در هنگام ثبت شناسه قبض استفاده گردید را تغییر داد. مقادیر ورودی و نحوه فراخوانی این سرویس دقیقا مانند سرویس "ثبت شناسه قبض" است با این تفاوت که وارد کردن کد ملی الزامی است.

- شناسه سرویس : 40256
- پارامترهای ورودی : json با ساختاری همانند سرویس قبل (ثبت شناسه قبض)

## سرویس حذف شناسه قبض از سامانه
 از این سرویس برای حذف شناسه قبضی که قبلا در سامانه ثبت شده استفاده میشود.
 - شناسه سرویس : 40257
 - پارامترهای ورودی : json با ساختار و پارامترهای زیر :


| نام | عنوان |شرح|
|-----------|-----------|--------|
| *Bill_IDENTIFIER | شناسه قبض |   |
| *MobileNo | شماره همراه | شماره همراه معتبر - اعتبارسنجی می‌گردد |
| *NatioanalCode | کدملی | کدملی معتبر - اعتبارسنجی می‌گردد |


**نمونه json ارسالی :**

```javascript 
{

"MobileNo":"0912*******",

"NationalCode":"9876543219",

"BILL_IDENTIFIER":1234567891

}
```

- پاسخ برگشتی : در صورت موفقیت آمیز بودن پاسخ سرویس به صورت زیر است :

```javascript 

{

“status”:200,

“message”:”عملیات با موفقیت انجام شد”,

“data”: null,

“errors”:[]

}
```

## سرویس دریافت شناسه قبض
با فراخوانی این سرویس میتوانید تمامی شناسه قبض هایی را که به همراه یک شماره تلفن همراه در سامانه ثبت شده اند را 
دریافت کنید.
- شناسه سرویس : 40258
- پارامترهای ورودی : json تک پارامتری شامل شماره موبایل به صورت زیر :


| نام |  نوع |شرح|
|-------------------------|---------------------|-----|
| *MobileNo | شماره موبایل |شماره معتبر که با 09 شروع می‌گردد-اعتبارسنجی می‌گردد|

  

**نمونه json ارسالی :**
  
   ```javascript 
 
{

“MobileNo”:”0912*******”

}

```

- پاسخ برگشتی در صورت موفقیت آمیز بودن :
  ```javascript 

{
  "timestamp": "2019-08-29T12:57:10Z"
  "status": 200,
  "message": "عملیات با موفقیت انجام شد" ,
  "data": {
      "billdata": [
        {some data},
        {some data},
        {
          "exdata": {
                  "firsName": "شکوه",
                  "lastName": "شکوری گرکانی",
                  "fabricNumber": "5050285"
          },
          "billtitle": "خانه",
          "viasms": false,
          "viaprint": true,
          "viaemail": true,
          "viaapp": true,
          "bill_identifier": "1187135705124"
        },
        {some data}
        ],
        "email": "x@info.com",
        "nationalcode": 0
  },
  "error": [],
  "traceno": "-1"
  
   }

  ```
  
  
  همانطور که در نمونه پاسخ برگشتی مشخص است، فیلدی به نام exdata وجود دارد که در آن اطلاعات اولیه مشترک 
  نمایش داده شده است.


## سرویس حذف حساب
با فراخوانی این سرویس تمام اطلاعات ثبت شده با یک شماره موبایل و کد ملی از سیستم حذف میشود.
این سرویس بانکی شامل چهار عملیات انتقال وجه، پرداخت قبض و فعالسازی بارکدخوان، خرید شارژ تلفن همراه، 
دریافت موجودی و گردش حساب میباشد که در ادامه به شرح هریک خواهیم پرداخت.
- شناسه سرویس : 41055
- پارامترهای ورودی : json با ساختار و پارامترهای زیر :
  
  
| نام | عنوان |شرح|
|----------|-----------|--------|
| *MobileNo | شماره همراه | شماره همراه معتبر - اعتبارسنجی می‌گردد |
| *NatioanalCode | کدملی | کدملی معتبر - اعتبارسنجی می‌گردد |

- پاسخ برگشتی : در صورت موفقیت آمیز بودن به صورت زیر است :

  ```javascript 

{

“status”:200,

“message”:”عملیات با موفقیت انجام شد”,

“data”: null,

“errors”:[]

}

```


## سرویس دریافت اطلاعات پایه انشعاب
 این سرویس جهت دریافت اطلاعات اولیه انشعاب فراخوانی خواهد شد. توجه شود که بدهی مشترک در این سرویس قرار ندارد و استفاده کنندگان بایستی از این سرویس برای نمایش اطلاعات اولیه مشترک استفاده کنند و برای بدهی از سرویس "استعلام بدهی انشعاب" استفاده نمایند.
 
-   شناسه سرویس : 40259
 - پارامترهای ورودی : json با ساختار و پارامترهای زیر :

|شرح|نوع|نام|
|-----|-----|------|
| *Bill_IDENTIFIER|شناسه قبض مشترک | شناسه قبض |
| *MobileNo | شماره تلفن همراه | شماره تلفن همراه ثبت شده به همراه ثبت شناسه قبض |

- پاسخ برگشتی :
خروجی این وب سرویس براساس استاندارد گفته شده خواهد بود که در صورتی که شناسه قبض در سامانه برای شماره موبایل داده شده ثبت شده باشد در قسمت data یک کلاس با ساختار زیر قرار می ‌گیرد که شامل اطلاعات انشعاب مربوط به شناسه قبض داده شده می‌باشد.

|شرح|نوع|نام فیلد|
|------|-------|-------|
| BILL_IDENTIFIER|NUMERIC(13)| شناسه قبض |
| PAYMENT_IDENTIFIER|NUMERIC(13)| شناسه پرداخت |
| COMPANY_CODE|NUMERIC(3)| کد شرکت توزیع براساس پیوست |
| COMPANY_NAME|CHARACHTER(80)| نام شرکت توزیع  |
| PHASE|NUMBER(1)|فاز (1:تکفاز، 3: سه فاز) |
| VOLTAGE_TYPE |NUMERIC(1) | نوع ولتاژ (1 :اولیه و 2 : ثانویه)
| AMPER|NUMERIC(4)| آمپر |
|CONTRACT_DEMAND|NUMERIC(10.2)|قدرت قراردادی|
|TARIFF_TYPE|NUMERIC(2)|نوع تعرفه :( 10 خانگی ، 11 خانگی آزاد ،20 عمومی ، 21 عمومی آزاد ، 30 کشاورزی ، 31 کشاورزی آزاد ، 40 صنعتی ، 41 صنعتی آزاد ، 50 تجاری ، 51 تجاری آزاد)|
|CUSTOMER_TYPE|NUMERIC(1)|نوع مشترک (1 حقیقی 2 حقوقی)|
|CUSTOMER_NAME|CHARACHTER(100)|نام مشترک|
|TEL_NUMBER|CHARACHTER(20)|شماره تلفن مشترک|
|MOBILE_NUMBER|CHARACHTER(11)|شماره تلفن همراه مشترک |
|SERVICE_ADD|CHARACHTER(100)|آدرس محل انشعاب |
|SERVICE_POST_CODE|CHARACHTER(10)|کدپستی محل انشعاب|
|LOCATION_STATUS|CHARACHTER(20)|محدوده جغرافیایی (1 شهری ، 2 روستایی، 3 خارج از محدوده خدمات شهری) |
|SERIAL_NUMBER|DATE|شماره بدنه کنتور|
|PAYMENT_DEAD_LINE|DATE|مهلت پرداخت بدهی|
|LAST_READ_DATE||تاریخ آخرین قرائت کنتور|
|LICENSE_EXPIRE_DATE|DATE|تاریخ انقضا پروانه (برای مشترکین دارای پروانه)|


**نمونه پاسخ برگشتی صحیح :**

  
  ```javascript 

{
  "timestamp": "2019-08-29T12:18:36Z"
  "status": 200,
  "message": "عملیات با موفقیت انجام شد" ,
  "data": {
      "ispaid": false,
      "bill_identifier": "5239279914121",
      "company_name": "توزیع نیروی برق مازندران",
      "company_code": "141",
      "phase": "1",
      "voltage_type": "1",
      "amper": "15",
      "contract_demand": "0",
      "tariff_type": "10",
      "customer_type": null,
      "natioanl_code": null,
      "costumer_name": "کاظم علی",
      "customer_family": "کاظمیان",
      "tel_number": null,
      "mobile_number": null,
      "service_add": "خیابان رضازاده",
      "locatioan_status": null,
      "serial_number": "10773510",
      "license_expire_date": null,
      "subscription_id": 114,
      "file_serial_number": 2392798,
      "x_degree": 0,
      "y_degree": 0,
      "service_post_code": ""
  },
  "error": [],
  "traceno": "-1"
  
        
  }
    
 
  ```
  

**نمونه پاسخ برگشتی که نشان‌دهنده خطا است :**
  
  
  ```javascript 

{
    "status": 500,
    "message": null,
    "data": null,
    "error": [
      {
              "errorCode": 502,
              "errorMsg": "شناسه قبض نامعتبر است"
      }
      ]
}
  
```
    
  

## سرویس استعلام بدهی انشعاب

 این سرویس جهت استعلام آخرین بدهی یک انشعاب استفاده میگردد.
 - شناسه سرویس : 41056
- پارامترهای ورودی : json با ساختار و پارامترهای زیر
  
  
|شرح|نوع|نام|
|----|-----|-----|
|*BILL_IDENTIFIER|شناسه قبض مشترک|شناسه قبض|
|*MobileNo|شماره تلفن همراه | شماره تلفن همراه ثبت شده به همراه ثبت شناسه قبض| 
  
  

- پاسخ برگشتی : در صورت موفقیت آمیز بودن ، json  با ساختار و پارامترهای زیر : 
  
  

|نام فیلد|نوع|شرح|
|------|-------|------|
|BILL_IDENTIFIER|NUMERIC(13)|شناسه قبض|
|PAYMENT_IDENTIFIER|NUMERIC(15)|مبلغ بدهی بابت مصرف انرژی |
|OTHER_ACCOUNT_DEBT|NUMERIC(15) |بدهی سایر خدمات یا خسارت|
|TOTAL_REGISTER_DEBT|NUMERIC(15)|بدهی واگذاری انشعاب برای انشعابات قسطی.مقدار این قلم برای سایر موارد صفر است|
|PAYMENT_DEAD_LINE|DATE|مهلت پرداخت بدهی|
|LAST_READ_DATE|| تاریخ آخرین قرائت کنتور |
  
  

**نمونه پاسخ برگشتی :**  

  ```javascript 

{
    "timestamp": "2019-08-29T02:33:29Z",
    "status": 200,
    "message": "عملیات با موفقیت انجام شد",
    "data": {
          "bill_identifier": "5239279914121",
          "total_register_debt": 0,
          "payment_identifier": "90880329",
          "total_bill_debt": "9008000",
          "other_account_debt": "0",
          "payment_dead_line": "2019-09-02T12:00:00Z",
          "last_gross_amt": 0,
          "last_sale_year": 0,
          "last_sale_prd": 0
    }
    "error": [],
    "traceno": "-1"
}

```


**توجه :** 

اگر در پاسخ این سرویس مقدار پارامتر payment_identifier زیر 6 رقم باشد، بدهی مشترک 0 است و یا مشترک بستانکار میباشد. در واقع حداقل میزان بدهی قابل پرداخت 1000 ریال میباشد و مبالغ بدهی کمتر از این مقدار قابل پرداخت نیستند و یا به عبارت دیگر دارای payment_idenifier زیر 6 رقم میباشند.

## سرویس جستجو بر اساس شماره بدنه :

<div>
در صورتی که برای دریافت اطلاعات انشعاب شناسه قبض در دسترس نباشد این امکان در سامانه دیده شده است تا با وارد کردن شناسه قبض و کد شرکت توزیع بتوان لیستی از اشتراک ‌های با شماره بدنه وارد شده را بازیابی نموده تا کاربر بتواند از میان  آنها شناسه قبض مربوط به خود را انتخاب کند.

- شناسه سرویس : 41057
-  پارامترهای ورودی: json با ساختار و پارامترهای زیر: 

|نام|نوع|شرح|
|----|-----|----|
|*SERIAL_NUMBER|CHARACTER(20)|شماره بدنه کنتور|
|CO_CODE|NUMERIC(3)|کد شرکت توزیع براساس پیوست|



توجه: شماره بدنه کنتور میتواند بخشی از شماره بدنه کنتور باشد ولی نباید از 7 رقم کوچکتر باشد.

- پاسخ برگشتی :
سامانه تمامی شماره‌ بدنه‌های مربوط به انشعابات  مربوط به یک شرکت توزیع را که کنتور  آنها شامل شماره بدنه  داده شده باشد را   جستجو کرده و  نتیجه را در خروجی نمایش میدهد و کاربر می‌تواند با چک کردن مشخصات انشعاب داده شده با مشخصات انشعاب خود اشتراک خود را بیابد و نسبت به ثبت آن در سامانه اقدام نماید.خروجی این وب‌سرویس  یک آرایه از اقلام جدول زیر می‌باشد(این آرایه در قسمت data خروجی برگشت داده شده قرار داده شده است)

|شرح|نوع|نام فیلد|
|------|-------|-------|
| BILL_IDENTIFIER|NUMERIC(13)| شناسه قبض |
| PAYMENT_IDENTIFIER|NUMERIC(13)| شناسه پرداخت |
| COMPANY_CODE|NUMERIC(3)| کد شرکت توزیع براساس پیوست |
| PHASE|NUMBER(1)|فاز (1:تکفاز، 3: سه فاز) |
| VOLTAGE_TYPE |NUMERIC(1) | نوع ولتاژ (1 :اولیه و 2 : ثانویه)
| AMPER|NUMERIC(4)| آمپر |
|CONTRACT_DEMAND|NUMERIC(10.2)|قدرت قراردادی|
|TARIFF_TYPE|NUMERIC(2)|نوع تعرفه :( 10 خانگی ، 11 خانگی آزاد ،20 عمومی ، 21 عمومی آزاد ، 30 کشاورزی ، 31 کشاورزی آزاد ، 40 صنعتی ، 41 صنعتی آزاد ، 50 تجاری ، 51 تجاری آزاد)|
|CUSTOMER_TYPE|NUMERIC(1)|نوع مشترک (1 حقیقی 2 حقوقی)|
|CUSTOMER_NAME|CHARACHTER(100)|نام مشترک|
|TEL_NUMBER|CHARACHTER(20)|شماره تلفن مشترک|
|MOBILE_NUMBER|CHARACHTER(11)|شماره تلفن همراه مشترک |
|SERVICE_ADD|CHARACHTER(100)|آدرس محل انشعاب |
|SERVICE_POST_CODE|CHARACHTER(10)|کدپستی محل انشعاب|
|LOCATION_STATUS|CHARACHTER(20)|محدوده جغرافیایی (1 شهری ، 2 روستایی، 3 خارج از محدوده خدمات شهری) |
|SERIAL_NUMBER|DATE|شماره بدنه کنتور|
|LICENSE_EXPIRE_DATE|DATE|تاریخ انقضا پروانه (برای مشترکین دارای پروانه)|
  
  
  
**نمونه پاسخ برگشتی صحیح : **
  
  
  ```javascript 
{
    "timestamp": "2019-08-29T03:03:56Z",
    "status": 200,
    "message": "عملیات با موفقیت انجام شد",
    "data": [
          {some data}
          {some data}
          {       
                    "ispaid": false,
                    "bill_identifier": "2183329014120",
                    "company_name": null,
                    "company_code": 141,
                    "phase": "1",
                    "voltage_type": "0",
                    "amper": "25",
                    "contract_demand": 5,
                    "tariff_type": "10",
                    "customer_type": null,
                    "national_code": null,
                    "customer_name": "موسی",
                    "customer_family": "ملایی",
                    "tel_number": null,
                    "mobile_number": null,
                    "service_add": null,
                    "location_status": null,
                    "serial_number": "46773510",
                    "license_expire_date": null,
                    "subscription_id": 3982,
                    "file_serial_number": 21833290,
                    "x_degree": 0,
                    "y_degree": 0,
                    "service_post_code": null
          }
        ],
        
    "error": [],
    "traceno": "-1"
}
 ```

**نمونه پاسخ برگشتی دارای خطا :**
  
  
  ```javascript 

{
    "timestamp": "2019-08-29T03:28:36Z",
    "status": 500,
    "message": "خطا در اعتبارسنجی مقادیر",
    "data": null,
    "error": [
      {
          "errorCode": 501,
          "errorMsg":"طول فیلد serial_number نبایستی از 7 کمتر باشد"
      },
      {
          "errorCode": 501,
          "errorMsg": "serial_number >> ورودی نامعتبر می باشد"

      }
      ],
      "traceno": "-1"

          "
    }
     
```
</div>
    
##  سرویس دریافت گروهی اطلاعات انشعاب :

 این سرویس جهت دریافت اطلاعات پایه بیش از یک انشعاب فراخوانی خواهد شد.
 - شناسه سرویس : 41059
 - پارامترهای ورودی : json با ساختار و پارامترهای زیر :

|نام|نوع|شرح|
|-----|----|-----|
|billList| لیستی از شناسه‌ قبض‌های مشترک | شناسه قبض |
| MobileNo| شماره تلفن همراه | شماره تلفن همراه ثبت شده به همراه شناسه قبض |

  
  
**نمونه json ارسالی :**
  
  ```javascript 
{

"MobileNo":"0912*******",

"billList":[

1234567891,

9876543219,

3698521473

]

}
```
  
  

- پاسخ برگشتی :
خروجی این وب‌سرویس بر اساس استاندارد گفته شده خواهد بود که در صورتی که شناسه قبض در سامانه برای شماره موبایل داده شده ثبت شده باشد در قسمت data  یک آرایه از کلاس با ساختار زیر قرار می گیرد که شامل اطلاعات انشعاب مربوط به شناسه قبض‌های داده شده می‌باشد :

|شرح|نوع|نام فیلد|
|------|-------|-------|
| BILL_IDENTIFIER|NUMERIC(13)| شناسه قبض |
| COMPANY_CODE|NUMERIC(3)| کد شرکت توزیع براساس پیوست |
| PHASE|NUMBER(1)|فاز (1:تکفاز، 3: سه فاز) |
| VOLTAGE_TYPE |NUMERIC(1) | نوع ولتاژ (1 :اولیه و 2 : ثانویه)
| AMPER|NUMERIC(4)| آمپر |
|CONTRACT_DEMAND|NUMERIC(10.2)|قدرت قراردادی|
|TARIFF_TYPE|NUMERIC(2)|نوع تعرفه :( 10 خانگی ، 11 خانگی آزاد ،20 عمومی ، 21 عمومی آزاد ، 30 کشاورزی ، 31 کشاورزی آزاد ، 40 صنعتی ، 41 صنعتی آزاد ، 50 تجاری ، 51 تجاری آزاد)|
|CUSTOMER_TYPE|NUMERIC(1)|نوع مشترک (1 حقیقی 2 حقوقی)|
|CUSTOMER_NAME|CHARACHTER(100)|نام مشترک|
|TEL_NUMBER|CHARACHTER(20)|شماره تلفن مشترک|
|MOBILE_NUMBER|CHARACHTER(11)|شماره تلفن همراه مشترک |
|SERVICE_ADD|CHARACHTER(100)|آدرس محل انشعاب |
|SERVICE_POST_CODE|CHARACHTER(10)|کدپستی محل انشعاب|
|LOCATION_STATUS|CHARACHTER(20)|محدوده جغرافیایی (1 شهری ، 2 روستایی، 3 خارج از محدوده خدمات شهری) |
|SERIAL_NUMBER|DATE|شماره بدنه کنتور|
|LICENSE_EXPIRE_DATE|DATE|تاریخ انقضا پروانه (برای مشترکین دارای پروانه)|
  
  
**نمونه پاسخ برگشتی در صورت موفقیت آمیز بودن :**
  
  
  ```javascript 
{
    "timestamp": "2019-08-29T03:48:04Z",
    "status": 200,
    "message": "عملیات با موفقیت انجام شد",
    "data": [
         
          {       
                    "ispaid": false,
                    "bill_identifier": "1239665706121",
                    "company_name": "توزیع نیروی برق شهرستان اهواز",
                    "company_code": 61,
                    "phase": "1",
                    "voltage_type": "1",
                    "amper": "25",
                    "contract_demand": 0,
                    "tariff_type": "50",
                    "customer_type": null,
                    "national_code": null,
                    "customer_name": null,
                    "customer_family": "عبدالواحد عساکره",
                    "tel_number": null,
                    "mobile_number": null,
                    "service_add": "جاده صنایع فولاد قریه چنعان خیابان دوم",
                    "location_status": null,
                    "serial_number": "10809428",
                    "license_expire_date": null,
                    "subscription_id": 1929623,
                    "file_serial_number": 7698785,
                    "x_degree": 0,
                    "y_degree": 0,
                    "service_post_code": ""
          },
           {some data},
           {some data},
           {some data},
           {some data},
           {some data},
           {some data},
           {some data},
        
  }
```    

** نمونه پاسخ برگشتی در صورت مواجهه با خطا : **
  
   ```javascript 
 {
    "status": 500,
    "message": null,
    "data": null,
    "error": [
      {
          "errorCode": 502,
          "errorMsg":"شناسه قبض نامعتبر است"
      }
      ]
  }
```

## دریافت اطلاعات فروش

از این وب ‌سرویس برای دریافت اطلاعات قبوض صادره برای یک انشعاب استفاده می‌گردد

- شناسه سرویس : 40260
- پارامترهای ورودی : json  با ساختار و پارامتر زیر :

|نام|نوع|شرح|
|----|-----|-----|
|*BILL_IDENTIFIER|NUMERIC(13)| شناسه قبض |
|*MobileNo|STRING(11)|شماره تلفن همراه ثبت شده به همراه ثبت شناسه قبض |
|FromYear|NUMERIC(4)| نمایش رکوردها از چه سالی انجام شود.پیش فرض 3 سال کمتر از سال جاری|
  
  

- پاسخ برگشتی :
خروجی این وب‌سرویس یک لیست از اطلاعات فروش انرزی مربوط به انشعاب می  باشد که این لیست آرایه از نوع کلاس زیر می‌باشد :
  
  
|نام فیلد|نوع|شرح|
|----|-----|----|
|BILL_IDENTIFIER|NUMERIC(13)|شناسه قبض|
|BILL_SERIAL|NUMERIC(4)|سریال صورتحساب|
|SALE_YEAR|NUMERIC(4)|سال فروش|
|SALE_PRD|NUMERIC(2)|دوره فروش|
|ISSUE_DATE|DATE|تاریخ صدور صورتحساب|
|PREV_READING_DATE|DATE|تاریخ قرائت قبلی صورتحساب|
|READING_DATE|DATE|تاریخ قرائت فعلی صورتحساب|
|NORMAL_CONS|NUMERIC(16.4)|مصرف میانباری|
|PEAK_CONS|NUMERIC(16.4)|مصرف پرباری|
|LOW_CONS|NUMERIC(16.4)|مصرف کم باری|
|FRIDAY|NUMERIC(16.4)|مصرف روز جمعه|
|REACT_CONS|NUMERIC(16.4)|مصرف راکتیو|
|DEMAND_READ|NUMERIC(16.4)|دیماند قرائت شده|
|AVG_COST|NUMERIC(15)|متوسط مصرف ماهانه انرژی|
|BILL_AMT|NUMERIC(15)|مبلغ صورتحساب (جمع اجزا صورتحساب به اضافه بدهی قبلی)|
|GROSS_AMT|NUMERIC(15)|مبلغ صورتحساب|
|INSURANCE_AMT|NUMERIC(15)|مبلغ بیمه|
|TAX_AMT|NUMERIC(15)|مبلغ مالیات (در سهم ارزش افزوده)|
|PAYTOLL_AMOOUNT|NUMERIC(15)|مبلغ عوارض (در سهم ارزش افزوده)|
|POWER_PAYTOLL_AMT|NUMERIC(15)|مبلغ عوارض برق|
|POWER_ENERGY_DEBIT|NUMERIC(15)|مبلغ بدهی قبلی بابت فروش انرژی|
|ENERGY_AMT|NUMERIC(15)|جمع مبلغ انرژی|
|REACTIVE_AMT|NUMERIC(15)|مبلغ راکتیو|
|DEMAND_AMT|NUMERIC(15)|مبلغ دیماند|
|SUBSC_AMT|NUMERIC(15)|مبلغ آبونمان|
|SEASON_AMT|NUMERIC(15)|مبلغ پیک فصل|
|LICENSE_EXPIRE_AMT|NUMERIC(15)|مبلغ جریمه بابت انقضا پروانه|
|FREE_AMT|NUMERIC(15)|مبلغ تفاوت انشعاب آزاد|
|GAS_DISCOUNT_AMT|NUMERIC(15)|مبلغ تخفیف عدم گازرسانی|
|DISCOUNT_AMT|NUMERIC(15)|مبلغ بخشودگی|
|WARM_AMT|NUMERIC(15)|مبلغ انرژی در ماههای گرم|
|COLD_AMT|NUMERIC(15)|مبلغ انرژی در ماههای سرد|
|*PROCESS_STATUS|NUMERIC(1)|اگر صورتحساب صحیح باشد برابر -1 و اگر باطل شده باشد برابر 1 می باشد|
|REJECT_DATE|Date|تاریخ ابطال صورتحساب در صورت باطل شدن|


  
<br>
<br>


**نمونه پاسخ برگشتی: در صورت موفقیت آمیز بودن به صورت زیر است :**
  ```javascript 
{
    "status": 200,
    "message": "عملیات با موفقیت انجام شد",
    "data": [
      {
      
          "bill_serial": 1,
          "sale_year": 98,
          "sale_prd": 1,
          "issue_date": "2019-05-05T06:15:29Z",
          "prev_reading_date": "2019-03-05T06:15:29Z"
          "reading_date": "2019-05-05T06:15:29Z"
          "normal_cons": 200,
          "peak_cons": 50,
          "low_cons": 100,
          "friday_cons": 0,
          "react_cons": 0,
          "demand_read": 0,
          "avg_cost": 0,
          "bill_amt": 1000,
          "gross_amt": 9000,
          "insurance_amt": 100,
          "tax_amt": 30,
          "paytoll_amt": 60,
          "power_paytoll_amt": 10,
          "previous_energy_deb": 1000,
          "energy_amt": 500,
          "reactive_amt": 0,
          "demand_amt": 0,
          "subsc_amt": 0,
          "season_amt": 0,
          "license_expire_amt": 0,
          "free_amt": 10,
          "gas_discount_amt": 0,
          "discount_amt": 0,
          "bill_identifier": 1345256314123
      }
      ],
      "error": []
}
```
        
          
##  سرویس دریافت اطلاعات وصول :

از این وب سرویس برای دریافت اطلاعات قبوض پرداخت شده توسط مشترک استفاده می گردد :

- شناسه سرویس : 40261
- پارامترهای ورودی : json با ساختار و پارامترهای زیر :


|نام فیلد|نوع|شرح|
|----|-----|----|
|*BILL_IDENTIFIER|NUMERIC(13)|شناسه قبض|
|*MobileNO|NUMERIC(13)|شماره تلفن همراه ثبت شده به همراه ثبت شناسه قبض|
|FromYear|NUMERIC(4)|نمایش رکورد ها از چه سالی انجام شود پیش فرض 3 سال کمتر از سال جاری|

- پاسخ برگشتی :

|نام فیلد|نوع|شرح|
|----|----|---|
|*BILL_IDENTIFIER|NUMERIC(13)|شناسه قبض|
|*PAYMENT_DATE|DATE|تاریخ پرداخت|
|*PAYMENT_AMT|NUMERIC(13)|مبلغ پرداختی|
|*BANK_CODE|NUMERIC(3)|کد بانک بر اساس لیست پیوست|
|REF_CODE|NUMERIC(20)|کد پیگیری|
|*CHANEL_TYPE|NUMERIC(2)|کانال پرداخت (براساس پیوست)|

  
  
  
**نمونه پاسخ برگشتی : در صورت موفقیت آمیز بودن**

  ```javascript 
{
    "status": 200,
    "message": "عملیات با موفقیت انجام شد",
    "data": [
      {
          "payment_DATE": "2019-05-05T06:12:37Z",
          "payment_AMT": 100000,
          "payment_identifier": "90880329",
          "bank_CODE": 12,
          "ref_CODE": 123456,
          "chanel_TYPE": 1,
          "bill_identifier": 1345256314123,
      },
      {
        
      }
          "payment_DATE": "2019-05-05T06:12:37Z",
          "payment_AMT": 200000,
          "bank_CODE": 17,
          "ref_CODE": 123456,
          "chanel_TYPE": 1,
          "bill_identifier": 1345256314123,
      }
      ],
      "error": []
      
}
          
      }
      ],
      "error": []
}
```



## سرویس دریافت تصویر آخرین قبض

از این وب‌سرویس برای دریافت تصویر آخرین قبض صادرشده برای مشترک استفاده می‌شود :

- شناسه سرویس : 40262
- پارامترهای ورودی : json با ساختار و ورودی‌های زیر :

 
| نام | عنوان |شرح|
|-----------|-----------|--------|
| *Bill_IDENTIFIER | NUMERIC(13) | شناسه قبض  |
| *MobileNo | NUMERIC(13) | شماره تلفن همراه ثبت شده به همراه ثبت شناسه قبض |

- پاسخ برگشتی :

:خروجی حاوی اطلاعات جدول زیر می باشد 
|نام|نوع|شرح|
|-----|-----|-----|
|*Bill_IDENTIFIER | NUMERIC(13) | شناسه قبض  |
| *PAYMENT_IDENTIFIER|NUMERIC(13)| شناسه پرداخت |
|*EXT|STRING|نوع فایل (.pdf , .jpg)|
|*PAYMENT_DEAD_LINE|DATE|تاریخ مهلت پرداخت|
|DOCUMENT|STRING|سند قبض با فرمت مشخص شده در ext و کدینگ base64|

**نمونه پاسخ برگشتی  در صورت موفقیت آمیز بودن : **

  ```javascript 
{
    "status": 200,
    "message": "عملیات با موفقیت انجام شد",
    "data": [
      {
          "ext": ".pdf",
          "document": "JVBERi0xljm1dqoxi...8b5cmc"
          "payment_dead_line": "2019-06-06T10:09:06.2117379+04:30",
          "payment_identifier": 1722370610,
          "bill_identifier": 6003276104323
          
      },
     
      "error": []
      
}
```
          
 همان طور که گفته شد مقدار document یک رشته 64base می باشد که باید تبدیل به byte[] شده و با فرمت pdf ذخیره و نمایش داده شود.

## سرویس استعلام قبض های صادر شده در یک بازه زمانی :

با استفاده از این وب‌سرویس می‌توان از قبض‌های صادر شده دریک بازه زمانی خاص مطلع شد.

- شناسه سرویس : 41061
- پارامترهای ورودی : json با ساختار و پارامترهای زیر :


|نام|نوع|شرح|
|-----|-----|-----|
|*CoCode|عدد حداکثر 3 رقم|کد شرکت توزیع بر اساس پیوست |
|*FromDate|تاریخ میلادی|تاریخ میلادی به همراه ساعت و ثانیه  براساس فرمت استاندارد سیستم برای دریافت قبض‌های صادر شده از این تاریخ به بعد |
|*ToDate|تاریخ میلادی|تاریخ میلادی به همراه ساعت و ثانیه  براساس فرمت استاندارد سیستم برای دریافت قبض‌های صادر شده تا این تاریخ  | 

  

- پاسخ برگشتی: json با ساختار و پارامترهای زیر :

|شرح|نوع|نام فیلد|
|------|-------|-------|
|*BILL_IDENTIFIER|NUMERIC(13)| شناسه قبض |
|*PAYMENT_IDENTIFIER|NUMERIC(13)| شناسه پرداخت |
|*SALE_YEAR|NUMERIC(4)|سال فروش|
|*SALE_PRD|NUMERIC(3)|دوره فروش|
|*PAYMENT_DEAL_LINE|DATE|مهلت پرداخت (تاریخ میلادی)|


**نمونه پاسخ برگشتی :**

  ```javascript 
{
    "timestamp": "2019-10-16T04:52:49Z",
    "status": 200,
    "sessionkey": "56cef054-e0b9-4412848b-d8febe0496f3",
    "message": "عملیات با موفقیت انجام شد",
    "data": [
      {''' 
        
      },
      {'''
        
      },
      {
        "bill_indetifier": 6860154604325,
        "sale_year" 98,
        "sale_prd" 3,
        "payment_dead_line": "2029-08-19T08:25:08.747"
      }
      ],
      
    "error": [],
    "traceno": "-1"
}
```



## سرویس ثبت اطلاعات پرداخت :

در صورتی که کاربر اقدام به پرداخت قبض نمود ذینفعی که از این سامانه به کاربر خدمت می‌دهد می‌تواند قبض پرداخت شده را در سامانه ثبت نماید.از این طریق بلافاصله به شرکت صادرکننده قبض اطلاع‌رسانی می‌گردد که قبض صادره پرداخت گردیده است و می‌تواند در روالهای کاری خود آن را در نظر بگیرد.به طور مثال در مواقعی که به علت عدم بدهی می‌خواهند برق مشترک را قطع کنند مشترکی که از طریق اطلاعات سامانه اقدام به پرداخت نماید و خدمت دهنده کاربر پرداختی را درسامانه  ثبت نماید این پرداخت بلافاصله به اطلاع شرکت رسانده می‌شود و شرکت در اقدام خود آن را در نظر میگیرد.





شناسه سرویس: 41079

پارامترهای ورودی: json با ساختار و پارامترهای زیر :

|نام فیلد|نوع|شرح|
|----|----|---|
|*BILL_IDENTIFIER|عدد حداکثر 13 رقم|شناسه قبض به صورت آرایه بر اساس نمونه|
|*PAYMENT_DATE|عدد حداکثر 13 رقم|شناسه پرداخت مندرج در قبض یا اطلاعات سامانه|
|*PayDate|تاریخ میلادی|تاریخ میلادی به همراه ساعت و ثانیه بر اساس فرمت استاندارد سیستم|
|*BankCode|عدد حداکثر 2 رقم|کد بانک بر اساس لیست پیوست|
|*RefCode| عدد حداکثر 20 رقم|کد پیگیری پرداخت|
|*Amount|عدد حداکثر 15 رقم| مبلغ پرداخت شدهکه بایستی با شناسه پرداخت همخوانی داشته باشد|
|*ChanelType||کانال پرداخت (براساس پیوست)|


